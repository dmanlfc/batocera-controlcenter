<features>
  <vgroup name="Top bar" role="header">
    <feature name="Time">
      <text display="${date +'%H:%M:%S'}" />
    </feature>
    <feature display="Batocera">
      <text display="${batocera-version | cut -d' ' -f1}" />
    </feature>
    <feature display="Resolution">
      <text display="${batocera-resolution currentResolution}" />
    </feature>
    <feature display="CPU">
      <text display="${ { head -n1 /proc/stat; sleep 0.2; head -n1 /proc/stat; } | awk '/^cpu /{u=$2-u; s=$4-s; i=$5-i; w=$6-w} END {print int(0.5+100*(u+s+w)/(u+s+i+w))}'}%" />
    </feature>
  </vgroup>
  <hgroup name="Sound" display="Sound Parameters">
    <vgroup>
      <feature>
        <button display="Vol -" action="batocera-audio setSystemVolume -5" />
        <text display="${batocera-audio getSystemVolume}%" />
        <button display="Vol +" action="batocera-audio setSystemVolume +5" />
      </feature>
      <feature display="Mute Sound" group="Audio/Video">
        <toggle
          value="${batocera-audio getSystemMute}"
          action_on="batocera-audio setSystemVolume mute"
          action_off="batocera-audio setSystemVolume unmute"
        />
      </feature>
    </vgroup>
  </hgroup>
  <hgroup display="Emulator">
    <vgroup>
      <img display='${IMG=$(curl http://127.0.0.1:1234/runningGame | jq -r .image); [ -n "$IMG" ] &amp;&amp; [ "$IMG" != "null" ] &amp;&amp; echo http://127.0.0.1:1234$IMG || echo "/usr/share/emulationstation/resources/services/logo-tri.png"}' height="100" />
      <hgroup>
        <feature name="Currently running" />
        <feature>
          <text display="${curl http://127.0.0.1:1234/runningGame | jq -r '(.name)' | sed 's/null/(no emulator)/'}" />
          <text display="${ps -o etime= -C emulatorlauncher 2>/dev/null | head -1}" />
        </feature>
      </hgroup>
      <feature>
        <button_confirm display="Kill it!" action="curl http://127.0.0.1:1234/emukill" />
      </feature>
    </vgroup>
  </hgroup>
  <hgroup name="id2" display="Power Parameters">
    <text display="${batocera_battery_checker}" />
    <vgroup>
      <feature name="PowerMode" display="Power Mode">
        <text display="${cat /sys/devices/system/cpu/cpufreq/policy0/scaling_governor}" />
        <choice display="Default"      action="batocera-power-mode default" />
        <choice display="AC"           action="batocera-power-mode ac" />
        <choice display="Battery"      action="batocera-power-mode battery" />
        <choice display="High Perf"    action="batocera-power-mode highperformance" />
        <choice display="Balanced"     action="batocera-power-mode balanced" />
        <choice display="Saver"        action="batocera-power-mode Powersaver" />
      </feature>
      <feature display="Plane Mode" group="Audio/Video">
        <toggle value="${batocera-planemode status}"
          action_on="batocera-planemode enable"
          action_off="batocera-planemode disable"
        />
      </feature>
    </vgroup>
  </hgroup>
</features>
